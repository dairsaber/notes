# 多表操作

## 一对一

- 使用场景

  人和身份证. 一个人只有一个身份证, 一个身份证只能对应一个人.

- 建表原则

  在任意一个表建立外键,去关联另外一张表的主键.

![image-20210329140711987](assets/image-20210329140711987.png)

![image-20210329140823506](assets/image-20210329140823506.png)

```sql
/* 一对一表 */
-- 创建db3数据库
CREATE DATABASE db3;
USE db3;
-- 创建person表 
CREATE TABLE person(
	id INT PRIMARY KEY AUTO_INCREMENT,
	NAME VARCHAR(30)
);

-- 向person表中添加数据 
INSERT INTO person VALUES
(null,'张三'),
(null,'李四');

-- 创建card表
CREATE TABLE card(
	id INT PRIMARY KEY AUTO_INCREMENT,
	number VARCHAR(20) UNIQUE NOT NULL,
	pid INT UNIQUE,
	CONSTRAINT cp_fkl FOREIGN KEY (pid) REFERENCES person(id)
);

-- 添加card的数据 
INSERT INTO card VALUES 
(null,'12345',1),
(null,'23456',2);

DESC card;
```

## 一对多

- 适用场景
  - 用户订单. 一个用户多个订单.
  - 商品分类和商品. 一个分类下面多个商品.

- 建表原则

  在多的一方, 建立外键约束, 来关联另一方的主键

![image-20210329143747368](assets/image-20210329143747368.png)

```sql
/* 一对多表 */

-- 创建USER表
CREATE TABLE USER(
	id INT PRIMARY KEY AUTO_INCREMENT,
	NAME VARCHAR(20)
);

-- 添加user数据 
INSERT INTO USER VALUES (NULL,'张三'),(NULL,'李四');

-- 创建orderlist表
CREATE TABLE orderlist(
	id INT PRIMARY KEY AUTO_INCREMENT,
	number VARCHAR(20) UNIQUE NOT NULL,
	uid INT,
	CONSTRAINT ou_fkl FOREIGN KEY (uid) REFERENCES USER(id)
);

-- 添加数据 
INSERT INTO orderlist VALUES 
(NULL,'hm001',1),
(NULL,'hm002',1),
(NULL,'hm003',2),
(NULL,'hm004',2);

# 案例2 分类 和 商品  假设一个分类下多个商品 

-- 创建分类表 
CREATE TABLE category(
	id INT PRIMARY KEY AUTO_INCREMENT,
	NAME VARCHAR(20)
);

-- 添加分类数据 
INSERT INTO category VALUES
(NULL, '手机数码'),
(NULL,'电脑办公');

-- 创建商品表 
CREATE TABLE product(
	id INT PRIMARY KEY AUTO_INCREMENT,
	NAME VARCHAR(30),
	cid INT,
	CONSTRAINT pc_fkl FOREIGN KEY (cid) REFERENCES category(id)
);

-- 添加几条数据 
INSERT INTO product VALUES
(NULL,'小米手机',1),
(NUll,'华为手机',1),
(NUll,'华为电脑',2),
(NUll,'苹果电脑',2);
```



## 多对多

- 适用场景

  学生和课程. 一个学生可以选择多个课程, 一个课程也能被多个学生所选择.

- 建表原则

  需要借助第三张表 `中间表`, 中间表至少包含两个列,分别关联两张表的主键.

![image-20210329150147620](assets/duoduiduo.png)

```sql

/*多对多*/

-- 创建学生表 
CREATE TABLE student(
	id INT PRIMARY KEY AUTO_INCREMENT,
	NAME VARCHAR(20)
);

-- 添加学生数据 
INSERT INTO student VALUES
(NULL, '张三'),
(NULL,'李四');

-- 创建课程表 
CREATE TABLE course(
 id INT PRIMARY KEY AUTO_INCREMENT,
 NAME VARCHAR(30)
);

-- 添加课程数据 
INSERT INTO course VALUES 
(NULL, '语文'),
(null,'数学');

-- 创建中间表 
CREATE TABLE stu_course(
 id INT PRIMARY KEY AUTO_INCREMENT,
 sid INT,
 cid INT,
 CONSTRAINT sc_fkl1 FOREIGN KEY (sid) REFERENCES student(id),
 CONSTRAINT sc_fkl2 FOREIGN KEY (cid) REFERENCES course(id)
);

-- 添加 一些中间表的数据 
INSERT INTO stu_course VALUES
(NULL,1,1),
(NULL,1,2),
(NULL,2,1),
(NULL,2,2);

```

